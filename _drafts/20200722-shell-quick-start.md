---
title: Shell 入门详解
date: 2020-07-22 19:42:57
tags: shell
---

[TOC]

## Shell 简介

shell是一种特殊的程序，是 `用户与Linux系统内核间的接口`，它解释运行由命令行或文件输入的命令，从而实现用户与内核间的交互。

## 内部命令

内部命令是shell命令的一部分，驻留在系统内存中，不需要创建子进程，例如 `cd exit echo history` 这些命令。使用 `man builtins` 可以看到 shell 中自带的内部命令。

> 以 `/` 开头的命令都不会触发内部命令，例如 `echo` 会调用内部命令，`/bin/echo` 或 `./echo` 则不会调用内部命令。

本文简要列了一些：

| 命令     | 是否外部 | sh是否支持 | 备注 |
| -------- | -------- | ---------- | ---- |
| alias    |          |            |      |
| bg       |          |            |      |
| bind     |          |            |      |
| break    |          |            |      |
| builtin  |          |            |      |
| case     |          |            |      |
| cd       |          |            |      |
| chdir    |          |            |      |
| command  |          |            |      |
| continue |          |            |      |
| do       |          |            |      |
| done     |          |            |      |
| echo     |          |            |      |
| elif     |          |            |      |
| else     |          |            |      |
| esac     |          |            |      |
| eval     |          |            |      |
| exit     |          |            |      |
| export   |          |            |      |
| false    |          |            |      |
| fc       |          |            |      |
| fg       |          |            |      |
| fi       |          |            |      |
| for      |          |            |      |
| getopts  |          |            |      |
| hash     |          |            |      |
| if       |          |            |      |
| jobid    |          |            |      |
| jobs     |          |            |      |
| local    |          |            |      |
| pwd      |          |            |      |
| read     |          |            |      |
| readonly |          |            |      |
| return   |          |            |      |
| set      |          |            |      |
| setvar   |          |            |      |
| shift    |          |            |      |
| test     |          |            |      |
| then     |          |            |      |
| times    |          |            |      |
| trap     |          |            |      |
| true     |          |            |      |
| type     |          |            |      |
| ulimit   |          |            |      |
| umask    |          |            |      |
| unalias  |          |            |      |
| unset    |          |            |      |
| until    |          |            |      |
| wait     |          |            |      |
| while    |          |            |      |
|          |          |            |      |

## 外部命令

外部命令其实并不是 shell 的内容，它们往往都是脚本文件或者二进制文件，需要的时候会加载到内存并创建对应的子进程，通常位于 `/bin` 或者 `/usr/bin` 等目录下。



## 变量

在 shell 中定义变量有两种方式，一种可以直接使用 `var_name="AAAA"` 的方式在定义变量的同时就为变量赋值，也可以使用 `declare -i number_var` 定义变量，然后稍后再给变量赋值。

> 注意变量赋值语句前后一定不要有空格！

使用变量要通过 `$` ，例如打印变量 `echo $var_name` 。还以加上花括号来引用变量，例如 `echo ${var_name}` 这种方式能够给出明确的变量边界，推荐在实际工作中都使用这种方式。

**一些常用的变量**：

* 命令行参数：`$0、$1......${10}`
* 命令行或者位置参数的个数：`$#`
* `$*`：所有位置参数，被作为一个单词。必须被""引用
* $@	：同$*，但每个参数都是一个独立的""引用。必须被引用
* `$!`	：在后台运行的最后的工作的 PID(进程ID)
* `$_`	：保存之前执行的命令的最后一个参数
* `$?`	：命令,函数或者脚本本身的退出状态
* `$$`	：脚本自身进程ID，常用来构造一个"unique"的临时文件名
* `$BASH`	：指向 Bash 的二进制执行文件的位置
* `FUNCNAME`：当前函数的名字
* `LINENO`：当前行号
* `HOME`：用户的 home 目录
* `PWD`：所在的当前目录
* `OLDPWD`：所在的之前的目录
* `PATH`：指向 Bash 外部命令所在的位置
* `SECONDS`：脚本已经运行的时间(单位为秒)

## 逻辑运算

shell 提供了丰富的逻辑运算符来满足我们常见的文件、数字、字符串等逻辑运算需求。

### 文件测试操作

* `-e` : 检测文件（包括目录）是否存在
* `-b` : 检测文件是否为块设备文件
* `-c` : 检测文件是否是字符设备文件
* `-d` : 检测文件是否为目录
* `-f` : 检测文件是否为普通文件（既不是目录，也不是块设备）
* `-s` : 检测文件是否为空，即文件的大小是否大于0
* `-p` : 检测文件是否为有名管道
* `-r` : 检测文件是否有读权限
* `-w` : 检测文件是否有写权限
* `-x` : 检测文件是否有执行权限
* `-g` : 检测文件是否设置了SGID位
* `-k` : 检测文件是否设置了粘着位（Sticky Bit）
* `-u` : 检测文件是否设置了SUID位
* `-L` : 判断是否为符号链接
* `-S` : 判读是否为socket文件
* `-nt` : 判断file1是否比file2新
* `-ot` : 判断file1是否比file2旧

### 整数比较

* `-eq` : 是否相等
* `-ne` : 是否不相等
* `-gt` : 是否大于
* `-ge` : 是否大于等于
* `-lt` : 是否小于
* `-le` : 是否小于等于

### 字符串比较

* `=:` : 等于
* `!=:` : 不等于
* `<:` ： 小于
* `>:` : 大于
* `-z` : 字符串长度为0
* `-n` : 字符串长度不为0