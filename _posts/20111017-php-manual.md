---
title: PHP手册阅读笔记
date: 2011-10-17 13:56:01
tag: 
---

学习PHP以来一直希望有时间能够有时间通读PHP手册，最近终于强迫自己划出一些时间，完成了对PHP手册的通读。除了函数参考部分没有每个都看，其他的章节基本上都看过了。看过之后才发现手册解决了自己之前对于PHP的一些模棱两可的认识，对PHP的掌握变的更加的全面和深入。

PHP手册分为几个大部分。包括：入门指引、安装与配置、语言参考、安全、特点。实际上为我们解决了什么是PHP？怎么准备PHP的环境？PHP应该怎样写？如何避免PHP代码的风险？PHP的一些特性这几个问题。后续还有函数参考、PHP的核心实现相关的一些话题、PHP的历史等一些内容。读完整个手册后，让我们能够了解到PHP这门语言的脉络 。



下面是我在阅读过程中作出的一些笔记摘抄，看到这些内容，实际上解决了我平时对于PHP的一些疑问，在这里记录下来以备后用。


**PHP数组提供了很多的功能，其背后是用什么样的数据结构来实现的？**


PHP 中的数组实际上是一个有序图。图是一种把 values 映射到 keys 的类型。此类型在很多方面做了优化，因此可以把它当成真正的数组来使用，或列表（矢量），散列表（是图的一种实现），字典，集合，栈，队列以及更多可能性。因为可以用另一个 PHP 数组作为值，也可以很容易地模拟树。


手册中并没有详细的讲解具体的实现原理，有兴趣的可以看看这篇文章[详解PHP中Array结构HashTable](http://liuzhiqiangruc.iteye.com/blog/1122715)。


**文件包含以及由此引起的问题**


话说 Require 和 Include 的区别大家都比较明白。require() 和 include() 除了怎样处理失败之外在各方面都完全一样。include() 产生一个警告而 require() 则导致一个致命错误。换句话说，如果想在丢失文件时停止处理页面，那就别犹豫了，用 require() 吧。include() 就不是这样，脚本会继续运行。同时也要确认设置了合适的include_path。


之前遇到过一个问题，一个输出图片的php文件，突然有一天访问的时候输出空白，而且程序也没有报错。当时检查半天之后发现是引用的php文件在?>结束符之后多了一个空行。看了下面的解释，就能够明白其中的道理了。


当一个文件被包含时，语法解析器在目标文件的开头脱离 PHP 模式并进入 HTML 模式，到文件结尾处恢复。由于此原因，目标文件中应被当作 PHP 代码执行的任何代码都必须被包括在有效的 PHP 起始和结束标记之中。（这个也许是引起空格问题的元凶）



**PHP的几种工作方式有什么区别**


PHP有三种工作方式。


第一种方法是将 PHP 用作一个“外壳”。以这种方法运行，PHP 会为向 web 服务器提出的每个 PHP 页面请求生成并结束一个 PHP 解释器线程。由于该线程会随每个请求的结束而结束，因此任何在这个线程中利用的任何资源（例如指向 SQL 数据库服务器的连接）都会随线程的结束而关闭。在这种情况下，使用永久连接不会获得任何地改变――因为它们根本不是永久的。


第二，也是最常用的方法，是把 PHP 用作多进程 web 服务器的一个模块，这种方法目前只适用于 Apache。对于一个多进程的服务器，其典型特征是有一个父进程和一组子进程协调运行，其中实际生成 web 页面的是子进程。每当客户端向父进程提出请求时，该请求会被传递给还没有被其它的客户端请求占用的子进程。这也就是说当相同的客户端第二次向服务端提出请求时，它将有可能被一个不同的子进程来处理。在开启了一个永久连接后，所有请求 SQL 服务的后继页面都能够重新使用这个已经建立的 SQL Server 连接。


最后一种方法是将 PHP 用作多线程 web 服务器的一个插件。目前 PHP 4 已经支持 ISAPI、WSAPI 和 NSAPI（在 Windows 环境下），这些使得 PHP 可以被用作诸如 Netscape FastTrack (iPlanet)、Microsoft's Internet Information Server (IIS) 和 O'Reilly's WebSite Pro 等多线程 web 服务器的插件。永久连接的行为和前面所描述的多过程模型在本质上是相同的。注意 PHP 3 不支持 SAPI。



**PHP中是如何处理引用的**


在 Zend 引擎 1 代，它驱动了 PHP4，对于变量的 static 和 global 定义是以 references 的方式实现的。例如，在一个函数域内部用 global 语句导入的一个真正的全局变量实际上是建立了一个到全局变量的引用。这有可能导致预料之外的行为。


在 PHP 中引用意味着用不同的名字访问同一个变量内容。这并不像 C 的指针，替代的是，引用是符号表别名。注意在 PHP 中，变量名和变量内容是不一样的，因此同样的内容可以有不同的名字。最接近的比喻是 Unix 的文件名和文件本身――变量名是目录条目，而变量内容则是文件本身。引用可以被看作是 Unix 文件系统中的 hardlink。

如果具有引用的数组被拷贝，其值不会解除引用。对于数组传值给函数也是如此。自 PHP 5 起，new 自动返回引用，因此在此使用 =& 已经过时了并且会产生 E_STRICT 级别的消息。


引用做的第二件事是用引用传递变量。这是通过在函数内建立一个本地变量并且该变量在呼叫范围内引用了同一个内容来实现的。



**PHP中的类**


类是变量与作用于这些变量的函数的集合。PHP 5 引入了新的对象模型（Object Model）。完全重写了 PHP 处理对象的方式，允许更佳性能和更多特性。


PHP 中没有析构函数。可以用 register_shutdown_function() 来替代模拟大多数析构函数的效果。


如果在用会话并使用了 session_register() 来注册对象，这些对象会在每个 PHP 页面结束时被自动序列化，并在接下来的每个页面中自动解序列化。基本上是说这些对象一旦成为会话的一部分，就能在任何页面中出现。


使用 __sleep 的目的是关闭对象可能具有的任何数据库连接，提交等待中的数据或进行类似的清除任务。此外，如果有非常大的对象而并不需要完全储存下来时此函数也很有用。


在 __autoload 函数中抛出的异常不能被 catch 语句块捕获并导致致命错误。


为了实现向后兼容性，如果 PHP 5 在类中找不到 __construct() 函数，它就会尝试寻找旧式的构造函数，也就是和类同名的函数。因此唯一会产生兼容性问题的情况是：类中已有一个名为 __construct() 的方法，但它却又不是构造函数。


类中的方法都必须使用关键字public、protected 或 private 进行定义。如果没有设置这些关键字，则该方法会被设置成默认的 public。


All methods declared in an interface must be public, this is the nature of an interface.


Both method calls and member accesses can be overloaded via the __call, __get and __set methods. All overloading methods must be defined as public.


Type Hints can only be of the object and array (since PHP 5.1) type. Traditional type hinting with int and string isn't supported.


**还有这样的事情？**


在读手册的过程中，也发现了平时可能不会想到的一些问题，也许大家看到了也有这样的感受，居然有这样的事情！


赋值语句本身求值为被赋的值，即 5。实际上这意味着“$a = 5”，不必管它是做什么的，是一个值为 5 的表达式。因而，这样写“$b = ($a = 5)”和这样写“$a =5; $b=5”（分号标志着语句的结束）是一样的。


如果比较一个整数和字符串，则字符串会被转换为整数。如果比较两个数字字符串，则作为整数比较。此规则也适用于 switch 语句。



在处理字符变量的算数运算时，PHP 沿袭了 Perl 的习惯，而非 C 的。例如，在 Perl 中 'Z'+1 将得到 'AA'，而在 C 中，'Z'+1 将得到 '['（ord('Z') == 90，ord('[') == 91）。注意字符变量只能递增，不能递减，并且只支持纯字母（a-z 和 A-Z）。


在 PHP 中可以调用递归函数。但是要避免递归函数／方法调用超过 100-200 层，因为可能会破坏堆栈从而使当前脚本终止。



从函数返回一个引用，必须在函数声明和指派返回值给一个变量时都使用引用操作符 & ：


PHP 支持变量函数的概念。这意味着如果一个变量名后有圆括号，PHP 将寻找与变量的值同名的函数，并且将尝试执行它。除了别的事情以外，这个可以被用于实现回调函数，函数表等等。



由于 PHP 的文件系统操作是基于 C 语言的函数的，所以它可能会以您意想不到的方式处理 Null 字符。


应用程序永远不要使用数据库所有者或超级用户帐号来连接数据库，因为这些帐号可以执行任意的操作，比如说修改数据库结构（例如删除一个表）或者清空整个数据库的内容.


防止用户从URL中伪造程序变量。注意区分$_REQUEST和$_POST\$_GET。


可以决定脚本是否需要在客户端中断连接时退出。有时候让脚本完整地运行会带来很多方便，即使没有远程浏览器接受脚本的输出。默认的情况是当远程客户端连接中断时脚本将会退出。该处理过程可由 php.ini 的 ignore_user_abort 或由 Apache .conf 设置中对应的“php_value ignore_user_abort”以及 ignore_user_abort() 函数来控制。


永久的数据库连接是指在脚本结束运行时不关闭的连接。当收到一个永久连接的请求时。PHP 将检查是否已经存在一个（前面已经开启的）相同的永久连接。如果存在，将直接使用这个连接；如果不存在，则建立一个新的连接。所谓“相同”的连接是指用相同的用户名和密码到相同主机的连接。


使用永久连接将（非常）有可能改变脚本的效率，但不改变其行为！




**PHP的其他函数**


PHP的函数参考中，包括189个项目分类。这个里面的函数众多，我觉得一一看完非常花时间，也未必看过之后马上能在实际中应用。还是了解一下分类，具体的使用在项目中进行查找比较合适。


参考资料：
1、PHP手册中文版
2、详解PHP中Array结构HashTable












